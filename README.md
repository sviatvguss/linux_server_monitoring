# Описание проекта "Система мониторинга сервера на базе Linux"

## Общее описание
Ядро системы - ***daemon***, программа, собирающая информацию о **сервере**, на котором запущена, и отправляющая её своим **клиентам** по GRPC.

## Архитектура системы
- GRPC сервер;
- использует временные (`/tmp`) файлы для внутренних нужд логики;
- статистика хранится в памяти, долговременное хранение не предусмотрено.

## Требования к системе
Каждые **N** секунд выдаётся информация, усредненная за последние **M** секунд.

Пример: N = 5с, M = 15с, сервис ничего не передаёт первые 15 секунд, затем выдает снапшот за 0-15с; через 5с (в 20с) выдает снапшот за 5-20с; через 5с (в 25с) выдает снапшот за 10-25с и т.д.

**N** и **M** указывает клиент в запросе на получение статистики.

Какая информация собирается сервисом:
- Средняя загрузка системы (load average).

- Средняя загрузка CPU (%user_mode, %system_mode, %idle).

- Загрузка дисков:
    - tps (transfers per second);
    - KB/s (kilobytes (read+write) per second);

- Информация о дисках по каждой файловой системе:
    - использовано мегабайт, % от доступного количества;
    - использовано inode, % от доступного количества.

- Top talkers по сети:
    - по протоколам: protocol (TCP, UDP, ICMP, etc), bytes, % от sum(bytes) за последние **M**), сортировка по убыванию процента;
    - по трафику: source ip:port, destination ip:port, protocol, bytes per second (bps), сортировка по убыванию bps.

- Статистика по сетевым соединениям:
    - слушающие TCP & UDP сокеты: command, pid, user, protocol, port;
    - количество TCP соединений, находящихся в разных состояниях (ESTAB, FIN_WAIT, SYN_RCV и пр.).

#### Используется исключительно стандартная библиотеку языка Go!

Некоторые команды, которые используются для сбора статистики:
```
$ top -b -n1
$ df -k
$ df -i
$ iostat -d -k
$ cat /proc/net/dev
$ sudo netstat -lntup
$ ss -ta
$ tcpdump -ntq -i any -P inout -l
$ tcpdump -nt -i any -P inout -ttt -l
```

Статистика представляет собой объекты, описанные в формате **Protobuf**.

Информация выдаётся всем подключенным по GRPC клиентам с использованием [однонаправленного потока](https://grpc.io/docs/tutorials/basic/go/#server-side-streaming-rpc).

Выдаваться "снапшот" системы может как в виде отдельного сообщения, так и одним жирным объектом (в процессе развития проекта может использоваться тот или иной подход).

Сбор информации, её парсинг и пр. осуществляется конкурентно.

## Поддерживаемая ОС
Минимум - Linux (Ubuntu 18.04).

## Конфигурация
- Через аргументы командной строки можно указать, на каком порту стартует сервер.
- Через файл можно указать, какие из подсистем сбора включены/выключены.

## Тестирование
#### Юнит-тесты
- по возможности мок интерфейсов и проверка вызовов конкретных методов;
- тесты вспомогательных функций и пр.

#### Интеграционные тесты
- потестировать факт потока статистики, можно без конкретных цифр;
- можно посоздавать файлы, пооткрывать сокеты и посмотреть на изменение снапшота.

#### Клиент
Доступен простой клиент, который в реальном времени получает и выводит в STDOUT статистику по одному из пунктов (например, сетевую информацию) в читаемом формате (например, в виде таблицы).
